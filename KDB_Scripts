// PairLegOne:   h"-2000#select  Date: Date, ReceiveDate:ReceiveDate, Symbol:Symbol, BidPrice1: BidPrice1, BidVol1:BidVol1, AskPrice1:AskPrice1, AskVol1: AskVol1 from Quote where Symbol = `sn1809";
// PairLegTwo:   h"-2000#select  Date: Date, ReceiveDate:ReceiveDate, Symbol:Symbol, BidPrice1: BidPrice1, BidVol1:BidVol1, AskPrice1:AskPrice1, AskVol1: AskVol1 from Quote where Symbol = `SN3M";
// PairLegThree:   h"-2000#select  Date: Date, ReceiveDate:ReceiveDate, Symbol:Symbol, BidPrice1: BidPrice1, BidVol1:BidVol1, AskPrice1:AskPrice1, AskVol1: AskVol1 from Quote where Symbol = `SN3M";

PairLegOne:  `Date`ReceiveDate`Symbol`LegOneBP1`LegOneBV1`LegOneSP1`LegOneSV1 xcol PairLegOne;
PairLegTwo:  `Date`ReceiveDate`Symbol`LegTwoBP1`LegTwoBV1`LegTwoSP1`LegTwoSV1 xcol PairLegTwo;
PairLegThree:`Date`ReceiveDate`Symbol`LegThreeBP1`LegThreeBV1`LegThreeSP1`LegThreeSV1 xcol PairLegThree;
PairLegOne: update LegTwoBP1:0Nf,LegTwoBV1:0N,LegTwoSP1:0Nf,LegTwoSV1:0N,LegThreeBP1:0Nf,LegThreeBV1:0N,LegThreeSP1:0Nf,LegThreeSV1:0N from PairLegOne;
PairLegTwo: update LegOneBP1:0Nf,LegOneBV1:0N,LegOneSP1:0Nf,LegOneSV1:0N,LegThreeBP1:0Nf,LegThreeBV1:0N,LegThreeSP1:0Nf,LegThreeSV1:0N from PairLegTwo;
PairLegThree:update LegOneBP1:0Nf,LegOneBV1:0N,LegOneSP1:0Nf,LegOneSV1:0N,LegTwoBP1:0Nf,LegTwoBV1:0N,LegTwoSP1:0Nf,LegTwoSV1:0N from PairLegThree;
PairLegOne:`Date`ReceiveDate`Symbol`LegOneBP1`LegOneBV1`LegOneSP1`LegOneSV1`LegTwoBP1`LegTwoBV1`LegTwoSP1`LegTwoSV1`LegThreeBP1`LegThreeBV1`LegThreeSP1`LegThreeSV1 xcols PairLegOne;
PairLegTwo:`Date`ReceiveDate`Symbol`LegOneBP1`LegOneBV1`LegOneSP1`LegOneSV1`LegTwoBP1`LegTwoBV1`LegTwoSP1`LegTwoSV1`LegThreeBP1`LegThreeBV1`LegThreeSP1`LegThreeSV1 xcols PairLegTwo;
PairLegThree:`Date`ReceiveDate`Symbol`LegOneBP1`LegOneBV1`LegOneSP1`LegOneSV1`LegTwoBP1`LegTwoBV1`LegTwoSP1`LegTwoSV1`LegThreeBP1`LegThreeBV1`LegThreeSP1`LegThreeSV1 xcols PairLegThree;
PairLegThree: select from PairLegThree where ReceiveDate = min ReceiveDate;
tempMultiplePair:`ReceiveDate xasc PairLegOne,PairLegTwo, PairLegThree;
MultiplePair:update LegOneBP1:fills  LegOneBP1,
LegOneBV1:fills  LegOneBV1,
LegOneSP1:fills  LegOneSP1,
LegOneSV1:fills  LegOneSV1,
LegTwoBP1:fills  LegTwoBP1,
LegTwoBV1:fills  LegTwoBV1,
LegTwoSP1:fills  LegTwoSP1,
LegTwoSV1:fills  LegTwoSV1,
LegThreeBP1:fills  LegThreeBP1,
LegThreeBV1:fills  LegThreeBV1,
LegThreeSP1:fills  LegThreeSP1,
LegThreeSV1:fills  LegThreeSV1  from tempMultiplePair;
MultiplePair:`Date`ReceiveDate`Symbol`LegOneBidPrice1`LegOneBidVol1`LegOneAskPrice1`LegOneAskVol1`LegTwoBidPrice1`LegTwoBidVol1`LegTwoAskPrice1`LegTwoAskVol1`LegThreeBidPrice1`LegThreeBidVol1`LegThreeAskPrice1`LegThreeAskVol1 xcol MultiplePair;
update BidPrice1:PairFormula[LegOneBidPrice1;LegTwoAskPrice1], BidVol1:1,AskPrice1:PairFormula[LegOneAskPrice1;LegTwoBidPrice1], AskVol1:1 from `MultiplePair;
MultiplePair:select from MultiplePair where LegOneBidPrice1<>0N;
MultiplePair:select from MultiplePair where LegTwoBidPrice1<>0N;
MultiplePair:select from MultiplePair where LegThreeBidPrice1<>0N;
strategyData:delete date,second from select by ReceiveDate.date, 1 xbar ReceiveDate.second from MultiplePair;
update LowerBand:bollingerBands[1;200;BidPrice1][0], HigherBand:bollingerBands[1;200;AskPrice1][2]  from `strategyData;
Signal: strategyData;update Signal:`Long from `Signal where AskPrice1 < LowerBand;update Signal:`Short from `Signal where BidPrice1 > HigherBand;
Signal:select from Signal where ((Signal = `Long) or  (Signal = `Short));
ShortLong:select from Signal  where (Signal<>(prev Signal));